<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

   <meta name="Author" content="Oyediran Oyewale">
  <meta name="description" content="A pattern for designing a good SQLite data-access layer for Android">
  <meta property="og:title" content="Android SQLite DAO Design &middot; Oyewale's Blog"/>
  <meta name="twitter:card" content="Android SQLite DAO Design &middot; Oyewale's Blog">
  <meta property="og:type" content="blog"/>
  <meta property="og:description" content="A pattern for designing a good SQLite data-access layer for Android"/>

  <link rel="author" href="https://plus.google.com/+OyewaleOyediran"/>

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Android SQLite DAO Design &middot; Oyewale
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/wale-custom.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">


  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0d">

    <div class="sidebar">
  
  <div class="container sidebar-sticky">
    <div class="circular"></div>
    <div class="sidebar-about" style="text-align: center;">
            
      <h1>Oyewale</h1>
      <p class="lead">For the love of Software</p>
    </div>

    <ul class="sidebar-nav" style="width: 50%; margin-left: auto; margin-right: auto; text-align: center;">
      <li class="sidebar-nav-item" >
        <a href="/">Home</a>
      </li>

      

      
      
        
          
        
      
        
          
            <li class="sidebar-nav-item">
              <a href="/about/">About</a>
            </li>
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

            
      
    </ul>

    <ul class="soc" style="margin-left: auto; margin-right: auto; text-align: center;">
      <li><a title="github" class="soc-github" target="_blank" href="http://github.com/waleoyediran"></a></li>
      <li><a title="twitter" class="soc-twitter" target="_blank" href="http://twitter.com/waleoyediran"></a></li>
      <li><a title="google" class="soc-google" target="_blank" href="http://facebook.com/waleoyediran"></a></li>
      <li><a title="linkedin" class="soc-linkedin soc-icon-last" target="_blank" href="http://linkedin.com/in/waleoyediran"></a></li>
  </ul>

  </div>
</div>


    <div class="content container">
      <article itemscope itemtype="http://schema.org/BlogPosting" class="post hentry">
  
  <div class="post">
    <header>
      <h1 class="post-title">Android SQLite DAO Design</h1>
    </header>

    <span class="post-date">02 Apr 2015</span>
    
    <section itemprop="articleBody">
      <p>In this post, i will be describing a pattern of designing a good SQLite data-access layer for Android.</p>

<p>When your application needs to offer complex data to other applications, the appriopriate approach is to use <a href="http://developer.android.com/guide/topics/providers/content-provider-creating.html">Content Providers</a>. But many simple applications do not need to copy data to other applications. After using various approaches to data-access design over the years, I have been highly influenced by the approach used by the <a href="https://github.com/ushahidi/Ushahidi_Android">Ushahidi Android</a> client.</p>

<p>Consider you want to store rows of Users in SQLite with the POJO described below:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
   <span class="kd">public</span> <span class="kt">int</span> <span class="n">id</span>
   <span class="kd">public</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
   <span class="kd">public</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
   <span class="kd">public</span> <span class="n">Date</span> <span class="n">createdDate</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div>
<p>We create an interface class that basically contains the Database schema definition. It contains table name, column names and table creation schema.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IUserSchema</span> <span class="o">{</span>
   <span class="n">String</span> <span class="n">USER_TABLE</span> <span class="o">=</span> <span class="s">&quot;users&quot;</span><span class="o">;</span>
   <span class="n">String</span> <span class="n">COLUMN_ID</span> <span class="o">=</span> <span class="s">&quot;_id&quot;</span><span class="o">;</span>
   <span class="n">String</span> <span class="n">COLUMN_USER_NAME</span> <span class="o">=</span> <span class="s">&quot;user_name&quot;</span><span class="o">;</span>
   <span class="n">String</span> <span class="n">COLUMN_EMAIL</span> <span class="o">=</span> <span class="s">&quot;email&quot;</span><span class="o">;</span>
   <span class="n">String</span> <span class="n">COLUMN_DATE</span> <span class="o">=</span> <span class="s">&quot;created_date&quot;</span><span class="o">;</span>
   <span class="n">String</span> <span class="n">USER_TABLE_CREATE</span> <span class="o">=</span> <span class="s">&quot;CREATE TABLE IF NOT EXISTS &quot;</span>
       <span class="o">+</span> <span class="n">USER_TABLE</span>
       <span class="o">+</span> <span class="s">&quot; (&quot;</span>
       <span class="o">+</span> <span class="n">COLUMN_ID</span>
       <span class="o">+</span> <span class="s">&quot; INTEGER PRIMARY KEY, &quot;</span>
       <span class="o">+</span> <span class="n">COLUMN_USER_NAME</span>
       <span class="o">+</span> <span class="s">&quot; TEXT NOT NULL, &quot;</span>
       <span class="o">+</span> <span class="n">COLUMN_EMAIL</span>
       <span class="o">+</span> <span class="s">&quot; TEXT,&quot;</span>
       <span class="o">+</span> <span class="n">COLUMN_DATE</span>
       <span class="o">+</span> <span class="s">&quot;BIGINT &quot;</span>
   <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="o">;</span>

   <span class="n">String</span><span class="o">[]</span> <span class="n">USER_COLUMNS</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span> <span class="n">COLUMN_ID</span><span class="o">,</span> 
      <span class="n">COLUMN_USER_NAME</span><span class="o">,</span> <span class="n">COLUMN_EMAIL</span><span class="o">,</span> <span class="n">COLUMN_DATE</span> <span class="o">};</span>
<span class="o">}</span>
</code></pre></div>
<p>The CRUD functionality is abstracted in a DbContentProvider class which is inherited by the UserDao class</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">DbContentProvider</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">SQLiteDatabase</span> <span class="n">mDb</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">delete</span><span class="o">(</span><span class="n">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="n">String</span> <span class="n">selection</span><span class="o">,</span> 
      <span class="n">String</span><span class="o">[]</span> <span class="n">selectionArgs</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mDb</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">tableName</span><span class="o">,</span> <span class="n">selection</span><span class="o">,</span> <span class="n">selectionArgs</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">insert</span><span class="o">(</span><span class="n">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="n">ContentValues</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mDb</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">tableName</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">cursorToEntity</span><span class="o">(</span><span class="n">Cursor</span> <span class="n">cursor</span><span class="o">);</span>

    <span class="kd">public</span> <span class="nf">DbContentProvider</span><span class="o">(</span><span class="n">SQLiteDatabase</span> <span class="n">db</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">this</span><span class="o">.</span><span class="na">mDb</span> <span class="o">=</span> <span class="n">db</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Cursor</span> <span class="nf">query</span><span class="o">(</span><span class="n">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">columns</span><span class="o">,</span> 
      <span class="n">String</span> <span class="n">selection</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">selectionArgs</span><span class="o">,</span> <span class="n">String</span> <span class="n">sortOrder</span><span class="o">)</span> <span class="o">{</span>

       <span class="kd">final</span> <span class="n">Cursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">mDb</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">tableName</span><span class="o">,</span> <span class="n">columns</span><span class="o">,</span> 
        <span class="n">selection</span><span class="o">,</span> <span class="n">selectionArgs</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">sortOrder</span><span class="o">);</span>

       <span class="k">return</span> <span class="n">cursor</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Cursor</span> <span class="nf">query</span><span class="o">(</span><span class="n">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">columns</span><span class="o">,</span> 
      <span class="n">String</span> <span class="n">selection</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">selectionArgs</span><span class="o">,</span> <span class="n">String</span> <span class="n">sortOrder</span><span class="o">,</span> 
      <span class="n">String</span> <span class="n">limit</span><span class="o">)</span> <span class="o">{</span>

       <span class="k">return</span> <span class="n">mDb</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">tableName</span><span class="o">,</span> <span class="n">columns</span><span class="o">,</span> <span class="n">selection</span><span class="o">,</span> 
        <span class="n">selectionArgs</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">sortOrder</span><span class="o">,</span> <span class="n">limit</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Cursor</span> <span class="nf">query</span><span class="o">(</span><span class="n">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">columns</span><span class="o">,</span> 
        <span class="n">String</span> <span class="n">selection</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">selectionArgs</span><span class="o">,</span> <span class="n">String</span> <span class="n">groupBy</span><span class="o">,</span> 
        <span class="n">String</span> <span class="n">having</span><span class="o">,</span> <span class="n">String</span> <span class="n">orderBy</span><span class="o">,</span> <span class="n">String</span> <span class="n">limit</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">return</span> <span class="n">mDb</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">tableName</span><span class="o">,</span> <span class="n">columns</span><span class="o">,</span> <span class="n">selection</span><span class="o">,</span> 
            <span class="n">selectionArgs</span><span class="o">,</span> <span class="n">groupBy</span><span class="o">,</span> <span class="n">having</span><span class="o">,</span> <span class="n">orderBy</span><span class="o">,</span> <span class="n">limit</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">update</span><span class="o">(</span><span class="n">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="n">ContentValues</span> <span class="n">values</span><span class="o">,</span>
        <span class="n">String</span> <span class="n">selection</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">selectionArgs</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mDb</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">tableName</span><span class="o">,</span> <span class="n">values</span><span class="o">,</span> <span class="n">selection</span><span class="o">,</span> 
          <span class="n">selectionArgs</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Cursor</span> <span class="nf">rawQuery</span><span class="o">(</span><span class="n">String</span> <span class="n">sql</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">selectionArgs</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mDb</span><span class="o">.</span><span class="na">rawQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">,</span> <span class="n">selectionArgs</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>The basic functions of the User data-access layer could optionally be described in an Interface such as this.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IUserDao</span> <span class="o">{</span>
   <span class="kd">public</span> <span class="n">User</span> <span class="nf">fetchUserById</span><span class="o">(</span><span class="kt">int</span> <span class="n">userId</span><span class="o">);</span>
   <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">fetchAllUsers</span><span class="o">();</span>
   <span class="c1">// add user</span>
   <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
   <span class="c1">// add users in bulk</span>
   <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addUsers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span><span class="o">);</span>
   <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">deleteAllUsers</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>
<p>Now we create our User Data Access class.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDao</span> <span class="kd">extends</span> <span class="n">DbContentProvider</span> 
   <span class="kd">implements</span> <span class="n">IUserSchema</span><span class="o">,</span> <span class="n">IUserDao</span> <span class="o">{</span>

   <span class="kd">private</span> <span class="n">Cursor</span> <span class="n">cursor</span><span class="o">;</span>
   <span class="kd">private</span> <span class="n">ContentValues</span> <span class="n">initialValues</span><span class="o">;</span>
   <span class="kd">public</span> <span class="nf">UserDao</span><span class="o">(</span><span class="n">SQLiteDatabase</span> <span class="n">db</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">super</span><span class="o">(</span><span class="n">db</span><span class="o">);</span>
   <span class="o">}</span>
   <span class="kd">public</span> <span class="n">User</span> <span class="nf">fetchUserByID</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
   <span class="kd">final</span> <span class="n">String</span> <span class="n">selectionArgs</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">id</span><span class="o">)</span> <span class="o">};</span>
   <span class="kd">final</span> <span class="n">String</span> <span class="n">selection</span> <span class="o">=</span> <span class="n">ID</span> <span class="o">+</span> <span class="s">&quot; = ?&quot;</span><span class="o">;</span>
   <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">User</span><span class="o">();</span>
   <span class="n">cursor</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">USER_TABLE</span><span class="o">,</span> <span class="n">USER_COLUMNS</span><span class="o">,</span> <span class="n">selection</span><span class="o">,</span>
           <span class="n">selectionArgs</span><span class="o">,</span> <span class="n">COLUMN_ID</span><span class="o">);</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">cursor</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">cursor</span><span class="o">.</span><span class="na">moveToFirst</span><span class="o">();</span>
       <span class="k">while</span> <span class="o">(!</span><span class="n">cursor</span><span class="o">.</span><span class="na">isAfterLast</span><span class="o">())</span> <span class="o">{</span>
           <span class="n">user</span> <span class="o">=</span> <span class="n">cursorToEntity</span><span class="o">(</span><span class="n">cursor</span><span class="o">);</span>
           <span class="n">cursor</span><span class="o">.</span><span class="na">moveToNext</span><span class="o">();</span>
       <span class="o">}</span>
       <span class="n">cursor</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">fetchAllUsers</span><span class="o">()</span> <span class="o">{</span>
       <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">userList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;();</span>
       <span class="n">cursor</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">USER_TABLE</span><span class="o">,</span> <span class="n">USER_COLUMNS</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span>
               <span class="kc">null</span><span class="o">,</span> <span class="n">COLUMN_ID</span><span class="o">);</span>

       <span class="k">if</span> <span class="o">(</span><span class="n">cursor</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">cursor</span><span class="o">.</span><span class="na">moveToFirst</span><span class="o">();</span>
           <span class="k">while</span> <span class="o">(!</span><span class="n">cursor</span><span class="o">.</span><span class="na">isAfterLast</span><span class="o">())</span> <span class="o">{</span>
               <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">cursorToEntity</span><span class="o">(</span><span class="n">cursor</span><span class="o">);</span>
               <span class="n">userList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
               <span class="n">cursor</span><span class="o">.</span><span class="na">moveToNext</span><span class="o">();</span>
           <span class="o">}</span>
           <span class="n">cursor</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
       <span class="o">}</span>

       <span class="k">return</span> <span class="n">userList</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
       <span class="c1">// set values</span>
       <span class="n">setContentValue</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
       <span class="k">try</span> <span class="o">{</span>
           <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">USER_TABLE</span><span class="o">,</span> <span class="n">getContentValue</span><span class="o">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span>
       <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLiteConstraintException</span> <span class="n">ex</span><span class="o">){</span>
           <span class="n">Log</span><span class="o">.</span><span class="na">w</span><span class="o">(</span><span class="s">&quot;Database&quot;</span><span class="o">,</span> <span class="n">ex</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
           <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
       <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="n">User</span> <span class="nf">cursorToEntity</span><span class="o">(</span><span class="n">Cursor</span> <span class="n">cursor</span><span class="o">)</span> <span class="o">{</span>

       <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">User</span><span class="o">();</span>

       <span class="kt">int</span> <span class="n">idIndex</span><span class="o">;</span>
       <span class="kt">int</span> <span class="n">userNameIndex</span><span class="o">;</span>
       <span class="kt">int</span> <span class="n">emailIndex</span><span class="o">;</span>
       <span class="kt">int</span> <span class="n">dateIndex</span><span class="o">;</span>

       <span class="k">if</span> <span class="o">(</span><span class="n">cursor</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">if</span> <span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">getColumnIndex</span><span class="o">(</span><span class="n">COLUMN_ID</span><span class="o">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
               <span class="n">idIndex</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getColumnIndexOrThrow</span><span class="o">(</span><span class="n">COLUMN_ID</span><span class="o">);</span>
               <span class="n">user</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="n">idIndex</span><span class="o">);</span>
           <span class="o">}</span>
           <span class="k">if</span> <span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">getColumnIndex</span><span class="o">(</span><span class="n">COLUMN_USER_NAME</span><span class="o">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
               <span class="n">userNameIndex</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getColumnIndexOrThrow</span><span class="o">(</span>
                <span class="n">COLUMN_USER_NAME</span><span class="o">);</span>
               <span class="n">user</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">userNameIndex</span><span class="o">);</span>
           <span class="o">}</span>
           <span class="k">if</span> <span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">getColumnIndex</span><span class="o">(</span><span class="n">COLUMN_EMAIL</span><span class="o">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
               <span class="n">emailIndex</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getColumnIndexOrThrow</span><span class="o">(</span>
                <span class="n">COLUMN_EMAIL</span><span class="o">);</span>
               <span class="n">user</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">emailIndex</span><span class="o">);</span>
           <span class="o">}</span>
           <span class="k">if</span> <span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">getColumnIndex</span><span class="o">(</span><span class="n">COLUMN_DATE</span><span class="o">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
               <span class="n">dateIndex</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getColumnIndexOrThrow</span><span class="o">(</span><span class="n">COLUMN_DATE</span><span class="o">);</span>
               <span class="n">user</span><span class="o">.</span><span class="na">createdDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="n">dateIndex</span><span class="o">));</span>
           <span class="o">}</span>

       <span class="o">}</span>
       <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setContentValue</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">initialValues</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ContentValues</span><span class="o">();</span>
       <span class="n">initialValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">COLUMN_ID</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
       <span class="n">initialValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">COLUMN_USER_NAME</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">username</span><span class="o">);</span>
       <span class="n">initialValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">COLUMN_EMAIL</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">email</span><span class="o">);</span>
       <span class="n">initialValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">COLUMN_DATE</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">createdDate</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">ContentValues</span> <span class="nf">getContentValue</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="n">initialValues</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div>
<p>Having our Data Access Object class setup, we then proceed to create our Database Helper class that provides an handle to the database resource. Its important to increment the DatabaseVersion on every schema change.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Database</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;MyDatabase&quot;</span><span class="o">;</span>
   <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DATABASE_NAME</span> <span class="o">=</span> <span class="s">&quot;my_database.db&quot;</span><span class="o">;</span>
   <span class="kd">private</span> <span class="n">DatabaseHelper</span> <span class="n">mDbHelper</span><span class="o">;</span>
   <span class="c1">// Increment DB Version on any schema change</span>
   <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DATABASE_VERSION</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="n">Context</span> <span class="n">mContext</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="n">UserDao</span> <span class="n">mUserDao</span><span class="o">;</span>



   <span class="kd">public</span> <span class="n">Database</span> <span class="nf">open</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
       <span class="n">mDbHelper</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">DatabaseHelper</span><span class="o">(</span><span class="n">mContext</span><span class="o">);</span>
       <span class="n">SQLiteDatabase</span> <span class="n">mDb</span> <span class="o">=</span> <span class="n">mDbHelper</span><span class="o">.</span><span class="na">getWritableDatabase</span><span class="o">();</span>

       <span class="n">mUserDao</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">UserDao</span><span class="o">(</span><span class="n">mDb</span><span class="o">);</span>

       <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
       <span class="n">mDbHelper</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nf">Database</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">this</span><span class="o">.</span><span class="na">mContext</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
   <span class="o">}</span>


   <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">DatabaseHelper</span> <span class="kd">extends</span> <span class="n">SQLiteOpenHelper</span> <span class="o">{</span>
       <span class="n">DatabaseHelper</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
           <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">DATABASE_NAME</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">DATABASE_VERSION</span><span class="o">);</span>
       <span class="o">}</span>

       <span class="nd">@Override</span>
       <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">SQLiteDatabase</span> <span class="n">db</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">db</span><span class="o">.</span><span class="na">execSQL</span><span class="o">(</span><span class="n">IUserSchema</span><span class="o">.</span><span class="na">USER_TABLE_CREATE</span><span class="o">);</span>
       <span class="o">}</span>

       <span class="nd">@Override</span>
       <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onUpgrade</span><span class="o">(</span><span class="n">SQLiteDatabase</span> <span class="n">db</span><span class="o">,</span> <span class="kt">int</span> <span class="n">oldVersion</span><span class="o">,</span>
          <span class="kt">int</span> <span class="n">newVersion</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">Log</span><span class="o">.</span><span class="na">w</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Upgrading database from version &quot;</span> 
                <span class="o">+</span> <span class="n">oldVersion</span> <span class="o">+</span> <span class="s">&quot; to &quot;</span>
                <span class="o">+</span> <span class="n">newVersion</span> <span class="o">+</span> <span class="s">&quot; which destroys all old data&quot;</span><span class="o">);</span>

           <span class="n">db</span><span class="o">.</span><span class="na">execSQL</span><span class="o">(</span><span class="s">&quot;DROP TABLE IF EXISTS &quot;</span> 
                <span class="o">+</span> <span class="n">IUserSchema</span><span class="o">.</span><span class="na">USER_TABLE</span><span class="o">);</span>
           <span class="n">onCreate</span><span class="o">(</span><span class="n">db</span><span class="o">);</span>

       <span class="o">}</span>
   <span class="o">}</span>

<span class="o">}</span>
</code></pre></div>
<p>The Database helper class creates an instance of the DAO class on opening the DB resource
The pattern aslo encourages having one static handle on the database  which could be created in a Application subclass. The DB is opened onCreate of the application and closed onTerminate to avoid leaks.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainApplication</span> <span class="kd">extends</span> <span class="n">Application</span> <span class="o">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="n">MainApplication</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="n">Database</span> <span class="n">mDb</span><span class="o">;</span>


   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
       <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
       <span class="n">mDb</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Database</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
       <span class="n">mDb</span><span class="o">.</span><span class="na">open</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTerminate</span><span class="o">()</span> <span class="o">{</span>
       <span class="n">mDb</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
       <span class="kd">super</span><span class="o">.</span><span class="na">onTerminate</span><span class="o">();</span>
   <span class="o">}</span>

<span class="o">}</span>
</code></pre></div>
<p>Now in any part of your application, you can grab a user by his id like this:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">UserEntity</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Database</span><span class="o">.</span><span class="na">mUserDao</span><span class="o">.</span><span class="na">fetchUserByID</span><span class="o">(</span><span class="n">userId</span><span class="o">);</span>
</code></pre></div>
<p>and insert a user into the Database</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">boolean</span> <span class="n">isSaved</span> <span class="o">=</span> <span class="n">Database</span><span class="o">.</span><span class="na">mUserDao</span><span class="o">.</span><span class="na">addUser</span><span class="o">(</span><span class="n">user</span><span class="o">)</span>
</code></pre></div>
<h3>Credit</h3>

<p>Much of the code here is adapted from the Ushahidi Android Client</p>

    </section>
  </div>
  

  <footer class="end-of-post" style="padding-top: 20px;">
                <g:plusone size="medium" href="http://waleoyediran.github.io"></g:plusone>
                <a href="https://twitter.com/share" class="twitter-share-button"
      data-url="http://waleoyediran.github.io"
      data-text="">
                        Tweet
                </a>
                <div class="fb-like" data-href="http://waleoyediran.github.io"
                     data-layout="button_count" data-action="like" data-show-faces="true" data-share="true">

                </div>
                <span class="entry-tags" style="padding-top: 20px; padding-bottom: 20px;">
      
    </span>
  </footer>
</article>

<meta itemprop="url" content="http://waleoyediran.github.io">

<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'oyewalesblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2015/07/16/event-driven-android/">
            Event Driven Android
            <small>16 Jul 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/04/09/building-imageing/">
            Building Imageing
            <small>09 Apr 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/06/10/enabling-sendmail-on-ubuntu/">
            Enabling SendMail on Ubuntu
            <small>10 Jun 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

    


    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/js/libs/jquery-1.7.1.min.js"><\/script>')</script>
	<script src="/js/libs/bootstrap.min.js"></script>
	<script src="/js/script.js"></script>

	<!-- Google +1 -->
	<script type="text/javascript">
	(function() {
		var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
		po.src = 'https://apis.google.com/js/plusone.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
	})();
	</script>

	<!-- Tweet button -->
	<script type="text/javascript">
	!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
	</script>

	<!-- Google analytics -->
	<script>
		var _gaq=[['_setAccount','UA-50081637-1'],['_trackPageview']];
		(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
		g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
		s.parentNode.insertBefore(g,s)}(document,'script'));
	</script>

	<div id="fb-root"></div>
	<script>(function(d, s, id) {
	    var js, fjs = d.getElementsByTagName(s)[0];
	    if (d.getElementById(id)) return;
	    js = d.createElement(s); js.id = id;
	    js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
	    fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));</script>
  </body>
</html>
